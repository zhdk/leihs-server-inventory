#!/usr/bin/env bash

set -eux

INVENTORY_DIR="$(cd -- "$(dirname "${BASH_SOURCE}")" ; cd .. > /dev/null 2>&1 && pwd -P)"
LEIHS_DIR=$INVENTORY_DIR/leihs

cd $INVENTORY_DIR

mkdir -p tmp

# rsync -e ssh -Lv --progress root@zhdk-leihs-prod-v5.ruby.zhdk.ch:/leihs/var/db-backups/latest.pgbin tmp/latest.pgbin

${LEIHS_DIR}/deploy/bin/ansible-playbook \
  -i ${INVENTORY_DIR}/hosts.yml \
  -l prod \
  -e "remote_pgbin_restore_path=/leihs/var/db-backups/latest.pgbin" \
  ${LEIHS_DIR}/deploy/db-restore_play.yml  $@

